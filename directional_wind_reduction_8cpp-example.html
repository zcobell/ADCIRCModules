<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ADCIRCModules: directional_wind_reduction.cpp</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">ADCIRCModules
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('directional_wind_reduction_8cpp-example.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">directional_wind_reduction.cpp</div>  </div>
</div><!--header-->
<div class="contents">
<p>Example usage provided by Keith Roberts</p>
<h1><a class="anchor" id="Prerequisites"></a>
Prerequisites</h1>
<ol type="1">
<li>Land use data, example: <a href="https://coast.noaa.gov/digitalcoast/data/ccapregional.html">CCAP</a></li>
<li>mesh file</li>
<li>fort13 file which contains the nodal attribute <div class="fragment"><div class="line">surface_directional_effective_roughness_length </div><div class="line">m</div><div class="line">12</div><div class="line">0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0 0.0</div><div class="line">surface_directional_effective_roughness_length</div><div class="line">0</div></div><!-- fragment --></li>
<li>Lookup Table (optional) - This is a table mapping land use class integers to values. If your raster already has values embedded, you can skip this <div class="fragment"><div class="line"> 2    0.500     :High Intensity Developed</div><div class="line"> 3    0.390     :Medium Intensity Developed</div><div class="line"> 4    0.500     :Low Intensity Developed</div><div class="line"> 5    0.330     :Developed Open Space</div><div class="line"> 6    0.060     :Cultivated Land</div><div class="line"> 7    0.060     :Pasture/Hay</div><div class="line"> 8    0.040     :Grassland</div><div class="line"> 9    0.650     :Deciduous Forest</div><div class="line">10    0.720     :Evergreen Forest</div><div class="line">11    0.710     :Mixed Forest</div><div class="line">12    0.120     :Scrub/Shrub</div><div class="line">13    0.550     :Palustrine Forested Wetland</div><div class="line">14    0.110     :Palustrine Scrub/Shrub Wetland</div><div class="line">15    0.110     :Palustrine Emergent Wetland</div><div class="line">16    0.550     :Estuarine Forested Wetland</div><div class="line">17    0.120     :Estuarine Scrub/Shrub Wetland</div><div class="line">18    0.110     :Estuarine Emergent Wetland</div><div class="line">19    0.090     :Unconsolidated Shore</div><div class="line">20    0.090     :Bare Land</div><div class="line">21    0.001     :Open Water</div><div class="line">22    0.040     :Palustrine Aquatic Bed</div><div class="line">23    0.040     :Estuarine Aquatic Bed</div></div><!-- fragment --> </li>
</ol>
<h1><a class="anchor" id="build"></a>
Building and Setup</h1>
<p>The code can be compiled to use the ADCIRCModules library using the following: </p><div class="fragment"><div class="line">g++ -I /usr/local/include/adcircmodules/  -ladcircmodules -std=c++14 directional_wind_reduction.cpp -o directional_wind_reduction</div></div><!-- fragment --><p> Note that the actual location of your include files may vary depending on your installation</p>
<p>You may want to test the code using only a few nodes at first. This can be done by turning of the interpolation flags as shown in the below c++ example. Because this calculation is time intensive, it is better to discover errors in your setup earlier than later. Note that this calculation can be performed using parallel processing (OpenMP) if it was enabled at compile time.</p>
<p>The land use raster data should be in a meters based coordinate system. While many other processes in ADCIRCModules are agnostic, this process requires the use of a meters based coordinate system. I typically use UTM. You can convert data to the coordinate system using GDAL.</p>
<div class="fragment"><div class="line">gdalwarp -t_srs ESPG:21918 source.tif output.tif</div></div><!-- fragment --><p>With these steps complete, you can run your executable. A progress bar will show the progress and (if using a terminal) estimated time remaining.</p>
<h1><a class="anchor" id="Output"></a>
Output</h1>
<p>When complete, you can use the <a href="https://github.com/CHLNDDEV/OceanMesh2D">OceanMesh</a> project scripts to visualize your data.</p>
<div class="fragment"><div class="line">m = msh(<span class="stringliteral">&#39;fname&#39;</span>,<span class="stringliteral">&#39;fort.14&#39;</span>,<span class="stringliteral">&#39;aux&#39;</span>,{<span class="stringliteral">&#39;myfort.13&#39;</span>}); </div><div class="line">plot(m,<span class="stringliteral">&#39;type&#39;</span>,<span class="stringliteral">&#39;dir&#39;</span>,<span class="stringliteral">&#39;proj&#39;</span>,<span class="stringliteral">&#39;lamb&#39;</span>); </div></div><!-- fragment --><p>The output will look something like: Note that by default it plots the infinity norm at each point (the largest directional wind stress reduction at each node of the grid).</p>
<div class="image">
<img src="sderl_01.png" alt="sderl_01.png" width="800px"/>
</div>
 <div class="image">
<img src="sderl_02.png" alt="sderl_02.png" width="800px"/>
</div>
<p>There is an equivalent python example provided here </p><div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">#!/usr/bin/env python</span></div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="keyword">import</span> pyadcircmodules <span class="keyword">as</span> pa</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;m = pa.Mesh(<span class="stringliteral">&quot;ms-riv.grd&quot;</span>)</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;n = pa.NodalAttributes(<span class="stringliteral">&quot;ms-riv.13&quot;</span>)</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;m.read()</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;n.read()</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;m.defineProjection(4326,<span class="keyword">True</span>)</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;idx = n.locateAttribute(<span class="stringliteral">&quot;surface_directional_effective_roughness_length&quot;</span>)</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;r = pa.Griddata(m,<span class="stringliteral">&quot;ccap_conus_2016_landcover2.tif&quot;</span>,26915)</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;r.setShowProgressBar(<span class="keyword">True</span>)</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;r.readLookupTable(<span class="stringliteral">&quot;CCAP_DWind.table&quot;</span>)</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;r.setInterpolationFlags(pa.Average)</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;dw = r.computeDirectionalWindReduction(<span class="keyword">True</span>)</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="keywordflow">for</span> i <span class="keywordflow">in</span> range(m.numNodes()):</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;    n.attribute(idx,i).setValue(dw[i])</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;n.write(<span class="stringliteral">&quot;new.13&quot;</span>)</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;</div></div><!-- fragment --><div class="fragment"><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div><div class="line"><span class="preprocessor">#include &lt;memory&gt;</span></div><div class="line"><span class="preprocessor">#include &quot;<a class="code" href="adcircmodules_8h.html">adcircmodules.h</a>&quot;</span></div><div class="line"></div><div class="line"><span class="keywordtype">int</span> main() {</div><div class="line">  <span class="keyword">using namespace </span><a class="code" href="namespaceAdcirc_1_1Geometry.html">Adcirc::Geometry</a>;</div><div class="line">  <span class="keyword">using namespace </span><a class="code" href="namespaceAdcirc_1_1Interpolation.html">Adcirc::Interpolation</a>;</div><div class="line">  <span class="keyword">using namespace </span><a class="code" href="namespaceAdcirc_1_1ModelParameters.html">Adcirc::ModelParameters</a>;</div><div class="line"></div><div class="line">  <span class="comment">// Generate the mesh object and read the file</span></div><div class="line">  <span class="keyword">auto</span> m = std::make_unique&lt;Mesh&gt;(<span class="stringliteral">&quot;../binera25m_wFP_tide_only.14&quot;</span>);</div><div class="line">  m-&gt;read();</div><div class="line">  m-&gt;defineProjection(4326, <span class="keyword">true</span>);</div><div class="line"></div><div class="line">  <span class="comment">// Generate the nodal attributes object, read the file, and find our target</span></div><div class="line">  <span class="comment">// attribute</span></div><div class="line">  <span class="keyword">auto</span> fort13 = std::make_unique&lt;NodalAttributes&gt;(</div><div class="line">      <span class="stringliteral">&quot;../binera25m_wFP_tide_only.13&quot;</span>, m.get());</div><div class="line">  fort13-&gt;read();</div><div class="line">  <span class="keyword">auto</span> midx2 =</div><div class="line">      fort13-&gt;locateAttribute(<span class="stringliteral">&quot;surface_directional_effective_roughness_length&quot;</span>);</div><div class="line"></div><div class="line">  <span class="comment">// Generate the griddata object with the raster and specify the epsg of the</span></div><div class="line">  <span class="comment">// coordinate system</span></div><div class="line">  <span class="keyword">auto</span> g = std::make_unique&lt;Griddata&gt;(m.get(), <span class="stringliteral">&quot;consu_epsg26918.tif&quot;</span>, 26918);</div><div class="line"></div><div class="line">  <span class="comment">// For testing, you may only want to do a subset of the model nodes. This loop</span></div><div class="line">  <span class="comment">// will only calculate the first 50 points. Omit this loop to do the entire</span></div><div class="line">  <span class="comment">// mesh</span></div><div class="line">  <span class="keywordflow">for</span> (<span class="keyword">auto</span> i = 0; i &lt; m-&gt;numNodes(); ++i) {</div><div class="line">    <span class="keywordflow">if</span> (i &lt; 50) {</div><div class="line">      g-&gt;setInterpolationFlag(i, <a name="a0"></a><a class="code" href="namespaceAdcirc_1_1Interpolation.html#a2a3c0067e44c5ef3210a256d06c16b0fab3c87ec2c47256239220b24e46acda7f">Adcirc::Interpolation::Average</a>);</div><div class="line">    } <span class="keywordflow">else</span> {</div><div class="line">      g-&gt;setInterpolationFlag(i, <a name="a1"></a><a class="code" href="namespaceAdcirc_1_1Interpolation.html#a2a3c0067e44c5ef3210a256d06c16b0fad3294110f834197038f2c7981c2b9eba">Adcirc::Interpolation::NoMethod</a>);</div><div class="line">    }</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">// Show the progress bar during the calculation</span></div><div class="line">  g-&gt;setShowProgressBar(<span class="keyword">true</span>);</div><div class="line"></div><div class="line">  <span class="comment">// Specify the lookup table</span></div><div class="line">  g-&gt;readLookupTable(<span class="stringliteral">&quot;../CCAP_DWind.table&quot;</span>);</div><div class="line"></div><div class="line">  <span class="comment">// For large rasters, do not put the entire raster into memory. Instead</span></div><div class="line">  <span class="comment">// read from the disk ask required</span></div><div class="line">  g-&gt;setRasterInMemory(<span class="keyword">false</span>);</div><div class="line"></div><div class="line">  <span class="comment">// Compute the directional wind reduction using a lookup table. The use</span></div><div class="line">  <span class="comment">// of a lookup table is specified using the [true] parameter</span></div><div class="line">  <span class="keyword">auto</span> r = g-&gt;computeDirectionalWindReduction(<span class="keyword">true</span>);</div><div class="line"></div><div class="line">  <span class="comment">// The return of the above command is just a 2d vector. Now, put the</span></div><div class="line">  <span class="comment">// values into the fort.13 object</span></div><div class="line">  <span class="keywordflow">for</span> (<span class="keyword">auto</span> i = 0; i &lt; m-&gt;numNodes(); ++i) {</div><div class="line">    fort13-&gt;attribute(midx2, i)-&gt;setValue(r[i]);</div><div class="line">  }</div><div class="line"></div><div class="line">  <span class="comment">// Write the fort.13 to disk</span></div><div class="line">  fort13-&gt;write(<span class="stringliteral">&quot;../binera25m_wFP_w_dir_ws.13&quot;</span>);</div><div class="line"></div><div class="line">  <span class="keywordflow">return</span> 0;</div><div class="line">}</div></div><!-- fragment --> </div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.13 </li>
  </ul>
</div>
</body>
</html>
